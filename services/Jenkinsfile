podTemplate(label: 'build', containers: [
    containerTemplate(name: 'ubuntu', image: 'ubuntu', command: 'cat', ttyEnabled: true)
  ],
  volumes: [
    hostPathVolume(mountPath: '/var/run/docker.sock', hostPath: '/var/run/docker.sock'),
  ]
  ) {
    node('build') {
      container('ubuntu') {
        sh 'apt update'  
        sh 'apt-get install -y git'
        sh 'mkdir app '
        sh 'ls -la'
        withCredentials([usernamePassword(credentialsId: '84bffb7c-a3bf-44f4-9471-977870eeed88', 
          passwordVariable: 'pass', usernameVariable: 'user')]){
            sh label: 'Login to Github', script: '''
git clone https://$user:$pass@github.com/JuanDavidBallesteros/rental_app.git ./app '''
          }
        sh 'curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash'
        withCredentials([usernamePassword(credentialsId: '84bffb7c-a3bf-44f4-9471-977870eeed88', 
          passwordVariable: 'pass', usernameVariable: 'user')]){
            sh label: 'Login to Github', script: '''
az login -u <username> -p <password> '''
          }
          sh 'az group create --name buildpipe --location eastus'
          sh 'az acr create --resource-group buildpipe --name tempregistry --sku Basic'
          sh '''
          az acr build --image sample/auth-app:v1 \
          --registry tempregistry \
          --file Dockerfile ./app 
  '''
          sh "az acr run --registry myContainerRegistry008 --cmd 'tempregistry/sample/hello-world:v1' /dev/null"
      }        
    }  
  }
 