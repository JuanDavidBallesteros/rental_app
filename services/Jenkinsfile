podTemplate(label: 'build',
  yaml: '''
    apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
    name: jenkins-test
    spec:
    accessModes:
    - ReadWriteOnce
    resources:
        requests:
        storage: 2Gi
''',
  containers: [
    containerTemplate(name: 'jenkins-test', image: 'docker', command: 'cat', ttyEnabled: true)
  ],
  volumes: [
    persistentVolumeClaim(mountPath: '/var/run/docker.sock', claimName: 'jenkins-test', readOnly: false),
  ],
  ) {
  node(POD_LABEL) {
    stage('Build') {
      container('docker') {
        stage('Building') {
          sh 'apk update'  
          sh 'apk add git'
          withCredentials([usernamePassword(credentialsId: '84bffb7c-a3bf-44f4-9471-977870eeed88', 
          passwordVariable: 'pass', usernameVariable: 'user')]){
            sh label: 'Login to Github', script: '''
git clone https://$user:$pass@github.com/JuanDavidBallesteros/rental_app.git . '''
          }
          sh 'docker build -t auth .'
        }
        
      }
    }

  }
}


